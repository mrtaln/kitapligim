<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AkÄ±llÄ± KitaplÄ±ÄŸÄ±m</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; background: #f4f4f9; }
        #reader { width: 100%; border: 2px solid #333; border-radius: 8px; overflow: hidden; }
        .book-card { background: white; padding: 15px; margin-top: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; align-items: center; }
        .book-card img { width: 50px; margin-right: 15px; }
        .stats { margin: 20px 0; font-weight: bold; color: #444; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <h2>ðŸ“š AkÄ±llÄ± KitaplÄ±ÄŸÄ±m</h2>
    
    <div id="reader"></div>
    
    <div class="stats">
        Toplam Kitap: <span id="total-count">0</span>
    </div>

    <div id="book-list">
        </div>

    <script>
        let myLibrary = [];

        // 1. Barkod TarayÄ±cÄ±yÄ± BaÅŸlat
        const html5QrCode = new Html5Qrcode("reader");
        const config = { fps: 10, qrbox: { width: 400, height: 250 }, formatsToSupport: [ Html5QrcodeSupportedFormats.EAN_13 ] };

        html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess);

        async function onScanSuccess(decodedText) {
            // AynÄ± barkodu Ã¼st Ã¼ste okumasÄ±nÄ± engellemek iÃ§in kÄ±sa sÃ¼reli durdurma
            console.log("Barkod AlgÄ±landÄ±:", decodedText);
            checkAndAddBook(decodedText);
        }

        // 2. Kitap Kontrol ve API Sorgusu
        async function checkAndAddBook(isbn) {
            // Kitap zaten listede var mÄ±?
            if (myLibrary.some(b => b.isbn === isbn)) {
                alert("Bu kitap zaten kitaplÄ±ÄŸÄ±nÄ±zda mevcut!");
                return;
            }

            try {
                const response = await fetch(`https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}`);
                const data = await response.json();

                if (data.totalItems > 0) {
                    const info = data.items[0].volumeInfo;
                    const newBook = {
                        isbn: isbn,
                        title: info.title,
                        author: info.authors ? info.authors[0] : "Bilinmiyor",
                        image: info.imageLinks ? info.imageLinks.thumbnail : "https://via.placeholder.com/50x75"
                    };

                    myLibrary.push(newBook);
                    renderLibrary();
                } else {
                    alert("Kitap bilgisi bulunamadÄ±.");
                }
            } catch (error) {
                console.error("Hata:", error);
            }
        }

        // 3. Listeyi ArayÃ¼zde GÃ¶ster
        function renderLibrary() {
            const listElement = document.getElementById("book-list");
            const countElement = document.getElementById("total-count");
            
            listElement.innerHTML = "";
            countElement.innerText = myLibrary.length;

            myLibrary.forEach(book => {
                const card = `
                    <div class="book-card">
                        <img src="${book.image}" alt="Kapak">
                        <div>
                            <strong>${book.title}</strong><br>
                            <small>${book.author}</small>
                        </div>
                    </div>
                `;
                listElement.innerHTML += card;
            });
        }
    </script>
</body>
</html>